<h1>V言語 ー RustとGoのいいとこ取りで、GCなし言語の新星</h1>
<p>投稿日: 2020/02/28 06:37:44</p>
<p>カテゴリ: なし</p>
<p>サムネイル: <img src="../../images/20200228065324.png"></p><hr>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="../../images/20200228065324.png" alt="f:id:funatsufumiya:20200228065324p:plain" title="f:id:funatsufumiya:20200228065324p:plain" class="hatena-fotolife" itemprop="image"></span></p>
<p>先日からRust言語にハマっていて、ついでに久々に<a href="https://github.com/kostya/benchmarks">ベンチマーク対決</a>を眺めていたら、<strong>V言語</strong>という見慣れない言語を発見。どうやら、まだ<a href="https://www.softantenna.com/wp/software/the-v-programming-language/">公開されて半年くらい</a>の新しい言語らしい。</p>
<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fvlang.io%2F" title="The V Programming Language" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://vlang.io/">vlang.io</a></cite></p>
<h2>シンプルさ・高速さが魅力</h2>
<p>V言語の最大の特徴は<strong>シンプルさ</strong>と<strong>高速さ</strong>。<a class="keyword" href="http://d.hatena.ne.jp/keyword/C%B8%C0%B8%EC">C言語</a>並みに高速で、かつ省メモリ・小サイズというのはかなり期待が持てる。（追記: 実際の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D9%A5%F3%A5%C1%A5%DE%A1%BC%A5%AF">ベンチマーク</a>速度は、確かに高速だが、RustやNimほどではなさそう。）</p>
<p>細かな文法については以下が詳しい。</p>
<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fqiita.com%2FMikuroXina%2Fitems%2Fbe3d4d9198cab32aed64" title="V プログラミング言語 - Qiita" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://qiita.com/MikuroXina/items/be3d4d9198cab32aed64">qiita.com</a></cite></p>
<p>構文は本当にシンプルで、習得が短期間でできることを謳っている。Rustゆずりの短い<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CD%BD%CC%F3%B8%EC">予約語</a>もあって、とても可読性が高い。（<a class="keyword" href="http://d.hatena.ne.jp/keyword/%CD%BD%CC%F3%B8%EC">予約語</a>の付け方は、Rustに似ている点が多い。構文はGoに似てる。）</p>
<p>サンプルコードは以下の <code>news_fetcher.v</code> あたりが分かりやすい。（記事に埋め込もうと思ったけれど、まだ<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A4%CF%A4%C6%A4%CA">はてな</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B7%A5%F3%A5%BF%A5%C3%A5%AF%A5%B9">シンタックス</a>ハイライトに対応しておらず、読みにくかった。）</p>
<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fgithub.com%2Fvlang%2Fv%2Fblob%2Fmaster%2Fexamples%2Fnews_fetcher.v" title="vlang/v" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://github.com/vlang/v/blob/master/examples/news_fetcher.v">github.com</a></cite></p>
<h2>Rustをよりシンプルにした代替言語となるか？</h2>
<p>個人的には、<strong><a class="keyword" href="http://d.hatena.ne.jp/keyword/Scala">Scala</a>とKotlinの構図によく似ている</strong>と感じていて、Rustが<a class="keyword" href="http://d.hatena.ne.jp/keyword/Scala">Scala</a>だとすると、V言語がKotlin。</p>
<p>Rust言語は非常に立ち位置が<a class="keyword" href="http://d.hatena.ne.jp/keyword/Scala">Scala</a>に似ていて、記述力と生産性が非常に高い言語である一方で、概念が多く、学習コストが非常に高い。一方のV言語は、まさにKotlinのようにシンプルで、それでいて今までの言語の良さを継承していて使い勝手が良い。</p>
<p>言語としての構文要素や概念が少ないので、シンプルすぎじゃないかと思うくらいだけど、ぱっと見た感じではよく設計されていて、過不足はなさそう。（Optionの<code>?</code>の扱いとかはKotlin風で、あとはGoとRustの影響が大きい。）</p>
<p>まだまだアーリーステージの言語なので、代替言語となり得るかは、これからに期待。</p>
<p>余談だけれど、自分は何度か<a href="https://nim-lang.org/">Nim言語</a>に触っては結局使うことがなかった経緯があって、結局Rustに落ち着いているのは、やっぱり<strong><a class="keyword" href="http://d.hatena.ne.jp/keyword/GC">GC</a>がない</strong>のが大きい。Nim言語は可読性と動作速度は非常に魅力だけれど、やはり<a class="keyword" href="http://d.hatena.ne.jp/keyword/GC">GC</a>がついている言語というのは、<a class="keyword" href="http://d.hatena.ne.jp/keyword/C/C%2B%2B">C/C++</a>に慣れていると何かと導入のネックになりやすい。</p>
<p>その点、V言語ははじめから<a class="keyword" href="http://d.hatena.ne.jp/keyword/GC">GC</a>を前提としない独自のメモリ管理をうたっているので、もし実際に<a class="keyword" href="http://d.hatena.ne.jp/keyword/GC">GC</a>なしでメモリ管理がうまくできるのであれば、とても期待が持てる。（追記: メモリ管理は開発途上で今後に期待。詳しくは末尾の追記参照。）</p>
<h2>高速な<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>と高い可読性</h2>
<p>まだ本当に初見だけれど、参考記事をいくつか眺めている感じでは、V言語の特徴はやはり<strong>高い可読性</strong>と、<strong>高速な<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>速度</strong>にあると思う。</p>
<p>例えばRust言語は、可読性は慣れると高い方だが、慣れないと読みづらく、難易度が高い。一方でV言語は、可読性が非常に高く、何より<strong>難易度が低い</strong>。One way to do somethingを掲げているだけあって、ループ構造がforしかないなど、誰が書いてもシンプルになるのは<strong><a class="keyword" href="http://d.hatena.ne.jp/keyword/Python">Python</a>に似ている気がする</strong>。</p>
<p>あと個人的には<strong>生成されたバイナリサイズが小さい</strong>のも魅力だと感じていて、このあたりも非常にKotlinの特徴と似ている気がする。</p>
<p>もっと言語として完成度が上がってくれば、このあたりの魅力が非常に強みになる言語だと思う。</p>
<h2>まだドキュメントが不十分</h2>
<p>早速使ってみたい感じはすごくする一方で、まだ公開されて日が浅く、ドキュメントがあまり充実していない。</p>
<p>特に気になるメモリ管理の部分もまだドキュメントが整備されておらず、詳細を確認するには<a class="keyword" href="http://d.hatena.ne.jp/keyword/GitHub">GitHub</a>を追っていくしかない模様（誰か英語で記事書いてたりするかも？）。</p>
<p>導入実績も非常に少ないので、まだ実践で使うには情報があまりに少ないという印象だけれど、RustやZigに次ぐ<a class="keyword" href="http://d.hatena.ne.jp/keyword/GC">GC</a>のない言語として、期待大。</p>
<p>V言語のメモリ管理周りは特に気になるので、今後追記していきたい。</p>
<h2>追記: メモリ管理周りはまだまだ開発段階</h2>
<p>この記事を書いてすぐ、<a class="keyword" href="http://d.hatena.ne.jp/keyword/GitHub">GitHub</a>や<a class="keyword" href="http://d.hatena.ne.jp/keyword/Reddit">Reddit</a>のいくつかのスレッドを見てみたが、どうやらメモリ管理周りは、まだ未完成の部分が多い。</p>
<p>特に、<a href="https://github.com/vlang/v/issues/571">Hello Worldでメモリリークが検出される</a>など、2020年2月時点ではまだまだ<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%E2%A5%EA%A5%EA%A1%BC%A5%AF">メモリリーク</a>に関する問題点は多い。それらの多くについては、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>時にASTを分析することで自動的に最適化しようと計画されているようだが（一部実装されているらしい）、既存の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A5%EB%A5%B4%A5%EA%A5%BA%A5%E0">アルゴリズム</a>の使用が予定されていて、Rustのように新規のメモリ管理の仕組みが存在するわけではなさそう。</p>
<p><a href="https://forum.vlang.io/post/29/Memory-Management">V言語フォーラムのメモリ管理についてのスレッド</a>でも議論が交わされているが、その<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>時の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A5%EB%A5%B4%A5%EA%A5%BA%A5%E0">アルゴリズム</a>もまだまだ選定段階・実験段階のようで、この議論などを見る感じでは、まだまだV言語はアーリーステージで、実際のプロダクトに利用できるのはかなり先になりそうな印象。（ただ逆に、メモリ管理まわりの実装さえ進めば、ぐんと実用的になりそうな予感もする。）</p>
<p>ちなみにV言語の更新頻度は、公開当初に比べると少し落ちていて、まだ導入事例や企業のバックアップなどもないようなので、これからどの程度コミットが続いていくかに期待したい。</p>
