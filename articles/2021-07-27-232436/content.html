<h1>ポメラハック1日目〜2日目</h1>
<p>投稿日: 2021/07/27 23:24:36</p>
<p>カテゴリ: Linux</p>
<p>サムネイル: <img src="../../images/20210727143833.jpg"></p><hr>

<p><span itemscope itemtype="http://schema.org/Photograph"><img src="../../images/20210727143833.jpg" alt="f:id:funatsufumiya:20210727143833j:plain" width="1200" height="900" loading="lazy" title="" class="hatena-fotolife" itemprop="image"></span></p>
<p>最近ついに<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DD%A5%E1%A5%E9">ポメラ</a>DM200を手に入れて、<a href="https://www.ekesete.net/log/?p=8940">EKESETE.netで配布されているDebian</a>を入れて<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DD%A5%E1%A5%E9">ポメラ</a>ハックをし始めた。Xを起動して<a class="keyword" href="http://d.hatena.ne.jp/keyword/GUI">GUI</a>を起動すると電池を食うのもあって、初期のコンソールのまま楽しむことにした。</p>
<p>昔から格安パソコンを手に入れて<a class="keyword" href="http://d.hatena.ne.jp/keyword/Debian">Debian</a>を入れてメインパソコンとして使ってきたので、メインが<a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>でこんなに小さいPCが手に入るなんて夢のようだった。GPD Pocketも好きだったのだけれど、やっぱり<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DD%A5%E1%A5%E9">ポメラ</a>は本来が文字打ち用に作られているだけあって、特にDM200はキーボードの品質が高くて素敵。</p>
<p>結果的には、せっかくのARM32マシンということもあって、ARMで動くいろんな言語や<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%E9">コンパイラ</a>を入れて遊んでいて、とりあえず最初に写真にある画面にSLが走るslコマンド（<code>apt install sl</code>）を動かしたり、<a href="https://github.com/y-hatano-github/go-puyo">コンソールで動くぷよぷよ</a>なんかを素朴に楽しんだりした。</p>
<p><figure class="figure-image figure-image-fotolife" title="Go-Puyoを動かしている様子"><span itemscope itemtype="http://schema.org/Photograph"><img src="../../images/20210727150842.jpg" alt="f:id:funatsufumiya:20210727150842j:plain" width="1200" height="900" loading="lazy" title="" class="hatena-fotolife" itemprop="image"></span><figcaption>Go-Puyoを動かしている様子</figcaption></figure></p>
<p>ただここまで動かせるようになるまでは相当に時間がかかって、自分が中古で購入したDM200は<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%D5%A5%A1%A1%BC%A5%E0%A5%A6%A5%A7%A5%A2">ファームウェア</a>が1.4というのもあるのか、通信機能は<a class="keyword" href="http://d.hatena.ne.jp/keyword/Debian">Debian</a>側では<a class="keyword" href="http://d.hatena.ne.jp/keyword/Bluetooth">Bluetooth</a>しかうまくいかず、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Wi-Fi">Wi-Fi</a>にも繋げないし、給電ハブを使ってもUSBはどうしても使えなかった。</p>
<p>（<strong>7/29 追記:</strong> <a href="https://github.com/nobotty/Documents/wiki/Pomera-DM200">https://github.com/nobotty/Documents/wiki/Pomera-DM200</a> にヒントを見つけ、無事<a class="keyword" href="http://d.hatena.ne.jp/keyword/Wi-Fi">Wi-Fi</a>が繋げるようになった！原因は一度<a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>の書き込みに失敗して二度上書きしたためで、別のSDできちんとリストアしてから、元の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Debian">Debian</a>を起動すると、<code>/opt/etc/firmware</code> 内にちゃんとファイルがあるので、これらをコピーしたところ問題なく接続できた。USBもそれが原因かも。後で検証。 ）</p>
<p>そんな環境でどうやってプログラムをインストールしたりしようか悩んだ末、<code>/mnt/vfat</code> としてマウントできるSDカード本体を使うしかなかったので、まず必要な<a class="keyword" href="http://d.hatena.ne.jp/keyword/deb">deb</a>ファイルを別のパソコンでダウンロードした後にSDにコピーして、<code>dpkg -i</code> で一つ一つインストールした。</p>
<p>slコマンドくらいはすぐにインストールすることができたのだけれど、<a href="http://hitoriblog.com/?p=54939">Bluetooth経由でiPhoneテザリング</a>をすることを目標にしたところ、依存ファイルが超多くて相当に苦戦。しぶしぶ自作の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ruby">Ruby</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8">スクリプト</a>を書いて依存ファイルを列挙したりしながら半手作業でコピーして、実際<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C6%A5%B6%A5%EA%A5%F3%A5%B0">テザリング</a>できるところまで行くのに半日潰れた。</p>
<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fgithub.com%2Ffunatsufumiya%2Fdeb-downloader" title="GitHub - funatsufumiya/deb-downloader: deb-downloader script using ruby" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://github.com/funatsufumiya/deb-downloader">github.com</a></cite></p>
<p>結果的には、ちゃっと<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C6%A5%B6%A5%EA%A5%F3%A5%B0">テザリング</a>でネットできて感動したし、一度ネットに繋がればaptが使えるようになってホッとした。</p>
<p><figure class="figure-image figure-image-fotolife" title="最初にpingがgoogleに通って感動したとき"><span itemscope itemtype="http://schema.org/Photograph"><img src="../../images/20210727142724.jpg" alt="f:id:funatsufumiya:20210727142724j:plain" width="1200" height="900" loading="lazy" title="" class="hatena-fotolife" itemprop="image"></span><figcaption>最初に<a class="keyword" href="http://d.hatena.ne.jp/keyword/ping">ping</a>が<a class="keyword" href="http://d.hatena.ne.jp/keyword/google">google</a>に通って感動したとき。<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C6%A5%B6%A5%EA%A5%F3%A5%B0">テザリング</a>経由できたのも感動。</figcaption></figure></p>
<p>ただ、安心したのもつかの間で、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Bluetooth">Bluetooth</a><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%C6%A5%B6%A5%EA%A5%F3%A5%B0">テザリング</a>は10KB/s程度の超低速でしかネットが使えないと知って愕然。1MBのファイルをダウンロードするのに10分くらいかかる。</p>
<p>結局、aptで列挙される必要なファイルと容量を目で確認して、そのうち大きなファイルはさっきの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B9%A5%AF%A5%EA%A5%D7%A5%C8">スクリプト</a>を使って別のPCでまとめてダウンロードしてコピー、dpkg。ネット開通前に比べてaptが使える分だけ作業は楽になったけど、結局、やってることは開通前とほぼ変わらず…。</p>
<p>でも、そうこうしているうちに欲しいプログラムは一通り揃って、最初こそただのコンソールだったけど、<a href="https://linuxfan.info/terminal-with-byobu">byobu</a>を入れたりしてすっかりカラフルな環境に早変わり。ここまでくればもう<a class="keyword" href="http://d.hatena.ne.jp/keyword/Linux">Linux</a>としては何も遜色なく使える。</p>
<p><figure class="figure-image figure-image-fotolife" title="byobu上でhtopを動かしている様子"><span itemscope itemtype="http://schema.org/Photograph"><img src="../../images/20210727151202.jpg" alt="f:id:funatsufumiya:20210727151202j:plain" width="1200" height="900" loading="lazy" title="" class="hatena-fotolife" itemprop="image"></span><figcaption>byobu上でhtopを動かしている様子</figcaption></figure></p>
<p>ここまできてようやく、自分がそもそも何をしたかったのかを思い出し、新下駄配列＋Programmer's <a class="keyword" href="http://d.hatena.ne.jp/keyword/Dvorak">Dvorak</a>を打てるようにさらに調査と試行錯誤をしてみて、少なくともProgrammer's <a class="keyword" href="http://d.hatena.ne.jp/keyword/Dvorak">Dvorak</a> (DvorakP) は問題なく使えるようになった。DvorakPのX用のキーマップファイルはすぐ手に入るものの、XなしのコンソールだけでDvorakPを使うためのキーマップは案外見つからなかったので、新しく書いた。</p>
<p><iframe src="https://hatenablog-parts.com/embed?url=https%3A%2F%2Fgithub.com%2Ffunatsufumiya%2Fprogrammer-dvorak-kmap" title="GitHub - funatsufumiya/programmer-dvorak-kmap" class="embed-card embed-webcard" scrolling="no" frameborder="0" style="display: block; width: 100%; height: 155px; max-width: 500px; margin: 10px 0px;"></iframe><cite class="hatena-citation"><a href="https://github.com/funatsufumiya/programmer-dvorak-kmap">github.com</a></cite></p>
<p>自分が普段使っている、CmdQwertyというかCtrlQwertyに近いものも収録してある。こちらはCtrl押下時に<a class="keyword" href="http://d.hatena.ne.jp/keyword/Qwerty">Qwerty</a>のショートカットが打てて便利だけど、一部対応できないCtrlキーがある。</p>
<p>さて一番肝心の新下駄配列の動作については、実はまだうまくいかず。Xで<a class="keyword" href="http://d.hatena.ne.jp/keyword/GUI">GUI</a>を有効化すれば多分簡単に使えるのだと思うけど、<a class="keyword" href="http://d.hatena.ne.jp/keyword/CUI">CUI</a>環境のせいかARM環境のせいなのか、oyainputでもうまく動かず。</p>
<p>（<strong>7/29 追記:</strong> <a href="https://www.ekesete.net/log/?p=8940#comments">Linux on Pomera DM200 &#x4EBA;&#x67F1;&#x7248; &#x305D;&#x306E;2 &ndash; &#x8A18;&#x9332;</a> の2018/5/28追記に記載があるように、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A1%BC%A5%CD%A5%EB">カーネル</a>の更新で <code>/dev/uinput</code> を追加するアップデートを作ってくださっているので、 <a href="https://github.com/nobotty/Documents/wiki/Pomera-DM200">Pomera DM200 &middot; nobotty/Documents Wiki &middot; GitHub</a> にに記載の手順で更新を<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%AB%A1%BC%A5%CD%A5%EB">カーネル</a>更新をすると、oyainputなどを動かすことが可能。素晴らしい。）</p>
<p><a href="https://qiita.com/derui/items/c0fb79a37cfd376bc774">新下駄配列をLinuxで動かすプログラム</a>を書いてくれた人が既にいて、<a class="keyword" href="http://d.hatena.ne.jp/keyword/OCaml">OCaml</a>をビルドしてみようとしたけれど、なにせネット通信が貧弱なせいで、opamのパッケージ取得にはとんでもなく時間がかかる上に、ARM環境というのも相まって、必要なパッケージの最新バージョンが手に入れられなかったりする始末。なので<a href="https://github.com/derui/okeyfum">okeyfum</a>はまだビルドをすることすらできない。</p>
<p>……という感じで、当初の目標であった新下駄配列＋DvorakPの小型メモマシンを作る計画自体はまだ実現できていないものの、DvorakP配列が使える便利な<a class="keyword" href="http://d.hatena.ne.jp/keyword/Debian">Debian</a> ARMパソコンとしては十分完成した感じがする。</p>
<p>この端末だけ持ち歩いてメモとかするには、今のところはまだ結局元の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DD%A5%E1%A5%E9">ポメラ</a>として<a class="keyword" href="http://d.hatena.ne.jp/keyword/%BF%C6%BB%D8%A5%B7%A5%D5%A5%C8">親指シフト</a>で入力して、プログラムしたいときは<a class="keyword" href="http://d.hatena.ne.jp/keyword/Debian">Debian</a>を起動するという感じ。ちょっと悔しいけど、どちらも起動できるというのはホント便利。</p>
<p>個人的にはコンソール専用ミニノートは喉から手が出るほど欲しかったので、それだけでも嬉しいのだけど、Xを起動させればoyainputとか、末には新下駄配列も使えるかもしれないと思うと、どうしてもうまく行かないときには<a class="keyword" href="http://d.hatena.ne.jp/keyword/GUI">GUI</a>も有効にするかな。</p>
<p>ちなみに、この<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DD%A5%E1%A5%E9">ポメラ</a>を丸２日ハックしたりプログラムを書いたりを極力DvorakPを使用してやっていて、自分のDvorakPの熟練度はだんだんと上がってきた。逆にときたま<a class="keyword" href="http://d.hatena.ne.jp/keyword/Qwerty">Qwerty</a>が入力できなくなって焦るけど、しばらく入力していれば感覚は戻る。なぜか<a class="keyword" href="http://d.hatena.ne.jp/keyword/Qwerty">Qwerty</a>で日本語を打つときは何も支障がないので不思議。<a class="keyword" href="http://d.hatena.ne.jp/keyword/Dvorak">Dvorak</a>と<a class="keyword" href="http://d.hatena.ne.jp/keyword/Qwerty">Qwerty</a>は似ている部分も多いので頭が混乱するんだろうか？もう少し<a class="keyword" href="http://d.hatena.ne.jp/keyword/Dvorak">Dvorak</a>の習熟度が上がって、何も意識することなく打てるレベルになれば、きっと<a class="keyword" href="http://d.hatena.ne.jp/keyword/Qwerty">Qwerty</a>に切り替えるのもそんなに苦じゃなくなると信じたい。逆かな。</p>
